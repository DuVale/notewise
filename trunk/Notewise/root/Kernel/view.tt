<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="[%base%]js/prototype.lite.js" type="text/javascript"></script>
    <script src="[%base%]js/moo.fx.js" type="text/javascript"></script>
    <script src="[%base%]js/moo.fx.pack.js" type="text/javascript"></script>
    <script src="[%base%]js/ui.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="[%base%]style.css"/>
    <link rel="icon" href="[%base%]images/favicon.ico" />
    <link rel="shortcut icon" href="[%base%]images/favicon.ico" />
</head>
<body>
    <div id="mysearchresults"></div>
    <div id="sidebar">
        <!-- sidebar accordion-style menus go in here; parents, rels, etc -->
        <table id="menutable" cellpadding="0" cellspacing="0" border="0">
            <tr><td style="padding: 5px">
            Search: <input autocomplete="off" id="mysearchfield" name="s"/>
            </td></tr>
            <tr><td style="vertical-align: top; background: white;">
                
                <div class="panetitle">
                    <div class="twistbutton" onmousedown="expandMenu(this, 'parents_content');">&nbsp;</div>
                    parents ([%kernel.parents.size or '0'%])
                </div>
                <div class="panecontent" id="parents_content">
                    <ul>
                        [% FOR parent = kernel.parents %]
                            <li><a href="[% base %]kernel/view/[%parent.id%]">[%parent.name%]</a></li>
                        [% END %]
                    </ul>
                </div>
                
                <div class="panetitle" onmousedown="resizeMenu_drag('parents_content');">
                    <div class="twistbutton" onclick="expandMenu(this, 'rel_content');">&nbsp;</div>
                    relationships ([%kernel.related_kernels.size or '0'%])

                </div>
                <div class="panecontent" id="rel_content">
                    <ul>
                        [% FOR sibling = kernel.related_kernels %]
                        <li><a href="[% base %]kernel/view/[%sibling.id%]">[%sibling.name%]</a></li>
                        [% END %]
                    </ul>
                </div>
                
            </td></tr>
            
            <tr><td>
                <div class="panetitle">
                    <div class="twistbutton nobutton">&nbsp;</div>
                    sandbox
                </div>
            </td></tr>
            <tr><td id="sandbox_container" style="height: 100%;">
                <div id="sandbox" style="position: relative;">
                </div>
            </td></tr>
        </table>
    </div>
    <div id="viewkernel">
        <!-- main content for the visiblekernel -->
        <input type="text" id="namefield0" class="namefield" autocomplete="off"
               value="[% kernel.name %]"
               style="width: [% kernel.name.length * 0.55 + 1 %]em;"/>
        [% FOR vkernel = visible_kernels %]
            [%INCLUDE 'Kernel/kernel.tt' i=0 %]
        [%END%]
        [% FOR note = notes %]
            [%INCLUDE 'Kernel/note.tt' i=0 %]
        [%END%]
    </div>
    <script type="text/javascript" src="[%base%]js/MochiKit.js"></script>
    <script type="text/javascript" src="[%base%]js/wz_jsgraphics.js"></script>
    <script type="text/javascript" src="[%base%]js/prototype.js"></script>
    <script type="text/javascript" src="[%base%]js/dragndrop.js"></script>
    <script type="text/javascript" src="[%base%]js/jsdbi.js"></script>
    <script type="text/javascript" src="[%base%]js/utils.js"></script>
    <script type="text/javascript" src="[%base%]js/linedraw.js"></script>
    <script type="text/javascript" src="[%base%]js/new_relationship.js"></script>
    <script type="text/javascript" src="[%base%]js/relationship.js"></script>
    <script type="text/javascript" src="[%base%]js/kernelobject.js"></script>
    <script type="text/javascript" src="[%base%]js/viewkernel.js"></script>
    <script type="text/javascript" src="[%base%]js/kernel.js"></script>
    <script type="text/javascript" src="[%base%]js/visiblekernel.js"></script>
    <script type="text/javascript" src="[%base%]js/note.js"></script>
    <script type="text/javascript" src="[%base%]js/controls.js"></script>
    <script type="text/javascript" src="[%base%]js/effects.js"></script>
    [%#
    use this instead of the above garbage to get faster loading of javascript
    <script type="text/javascript" src="/javascript"></script>
    %]
    <script>
        // configure the base url for jsdbi
        JSDBI.base_url('[% base %]');
        // XXX this is pretty nasty - put this inside the view's vkernel instead
        var vkernelCache = {};
    </script>

    [% FOR vkernel = visible_kernels %]
        [% i = 0 %]
        [%INCLUDE 'Kernel/kernel-js.tt'%]
    [%END%]
    [% FOR note = notes %]
        [% i = 0 %]
        [%INCLUDE 'Kernel/note-js.tt'%]
    [%END%]
    <script>

        var viewKernelId=[%kernel.id%];
        var view = new ViewKernel([%kernel.id%],document.getElementById('viewkernel'));

        function clearSelection (e) {
            VisibleKernel.prototype.clearSelectionAndTerminate(e);
        }
        Utils.registerEventListener(view.htmlElement,"mousedown",clearSelection);

        var vkernel1=vkernelCache['682/1597'];
        var vkernel2=vkernelCache['682/1596'];
        if(vkernel1 && vkernel2){
            var relationship = new Relationship(vkernel1,vkernel2);
        } else {
//            alert("couldn't find the right kernels to create the relationship");
        }

        new Ajax.Autocompleter('mysearchfield', 'mysearchresults', '[%base%]ac', {frequency: .2});
    </script>
</body>
</html>
